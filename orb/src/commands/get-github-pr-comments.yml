description: >
  This command provide a way to query the GitHub API for PR comments.
parameters:
  repo:
    type: string
  pr-number:
    type: string
  message:
    type: string
  user-type:
    type: string
    default: "User"
  token-name:
    type: env_var_name
    default: GITHUB_APP_TOKEN
  output-comment-id:
    type: string
    default: COMMENT_ID
    description: "The name of the environment variable to store the comment ID in"
steps:
  - setup-circleci-utils
  - run:
      name: Get PR Comments
      command: |

        COMMENT_ID=$( python $CIRCLECI_TOOLS_PATH get-pr-comments \
          --github-token "${<< parameters.token-name >>}" \
          --repo "<< parameters.repo >>" \
          --pr-number "<< parameters.pr-number >>" \
          --message-substring "<<parameters.message>>" \
          --user-type "<<parameters.user-type>>" )

        COMMENT_ID=$(echo "$COMMENT_ID" | tr -d ' \n' | cut -d',' -f1)
        echo "export << parameters.output-comment-id >>=$COMMENT_ID" >> "$BASH_ENV"
